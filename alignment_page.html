<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>NVBIO: Alignment Module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
  m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-47310325-1', 'nvlabs.github.io');
    ga('send', 'pageview');
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NVBIO
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">NVBIO</a></li><li class="navelem"><a class="el" href="nvbio_page.html">NVBIO</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Alignment Module </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"> 
 <img src="nvidia_cubes.png" style="position:relative; bottom:-10px; border:0px;"/>
 <dl class="section user"><dt></dt><dd>This module contains a series of functions to perform string alignment. Most of them can be called both from host (CPU) and device (GPU) code, although some target only the device (e.g. the warp-parallel ones), and others are host functions that execute various kernels on the device (e.g. the ones for <a class="el" href="alignment_page.html#BatchAlignmentSection">Batch Alignment</a>).<br/>
 Generally speaking, all these functions are parametrized over the alignment algorithm, which is specified by an <a class="el" href="group___aligner.html">Aligner</a> object. The aligner encodes the scheme used to score character matches, mismatches, insertions and deletions. Currently, there are three types of aligners, <a class="el" href="structnvbio_1_1aln_1_1_edit_distance_aligner.html#EditDistanceAligner">Edit Distance</a>, <a class="el" href="structnvbio_1_1aln_1_1_smith_waterman_aligner.html#SmithWatermanAligner">Smith-Waterman</a> and <a class="el" href="structnvbio_1_1aln_1_1_gotoh_aligner.html#GotohAligner">Gotoh</a>. </dd></dl>
<dl class="section user"><dt></dt><dd>The main functionalities are scoring, traceback and batch alignment. The following is a brief overview; for a detailed list of all classes and functions see the <a class="el" href="group___alignment.html">Alignment Module</a> documentation.</dd></dl>
<h1><a class="anchor" id="ScoringSection"></a>
Scoring</h1>
<dl class="section user"><dt></dt><dd>Scoring is the process of computing the dynamic programming matrix of the scores of all possible alignments between a pattern string P and a text string T (roughly speaking, the cell (i,j) of the DP matrix encodes the best possible score between the suffix T[0:i] and the suffix P[0,j]). The scoring functions do not compute the actual alignments, they just assign scores to all possible valid alignments and identify them by their last cell. These, are passed to an <a class="el" href="group___alignment_sink.html">Alignment Sink</a>, a user-defined delegate responsible for handling the results. </dd></dl>
<dl class="section user"><dt></dt><dd>The module exposes several variants of the following functions:<ul>
<li><a class="el" href="group___alignment.html#ga0ff728fc0b7e7d91671772d29b3279d2">banded_alignment_score()</a></li>
<li><a class="el" href="group___alignment.html#gaf145af0b7332e9e003ea3cdf2db87a3c">alignment_score()</a> </li>
</ul>
</dd></dl>
<dl class="section user"><dt></dt><dd>according to whether one wants to process a pattern with qualities or not, whether he's interested in a single best score or the best N, and so on. To see a concrete usage example, consider the following code snippet:</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> vector_view&lt;const char*&gt; const_string;</div>
<div class="line"></div>
<div class="line">const_string  <a class="code" href="group___rank_dictionary_module.html#ga71a2197ba0cf4fd168a7c8f60865d0a6">text</a> = <a class="code" href="namespacenvbio_1_1aln.html#a93eb618cd746bb4611375f2d9a531b1c">make_string</a>(<span class="stringliteral">&quot;AAAAGGGTGCTCAA&quot;</span>);</div>
<div class="line">const_string  pattern  = <a class="code" href="namespacenvbio_1_1aln.html#a93eb618cd746bb4611375f2d9a531b1c">make_string</a>(<span class="stringliteral">&quot;GGGTGCTCAA&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="group___basic.html#ga938b5b5bd985a42f95879b4616c3ea8a">int32</a> ed = aln::banded_alignment_score&lt;5&gt;(</div>
<div class="line">       aln::make_edit_distance_aligner&lt;aln::SEMI_GLOBAL&gt;(), <span class="comment">// build an edit-distance aligner</span></div>
<div class="line">       pattern,                                             <span class="comment">// pattern string</span></div>
<div class="line">       text,                                                <span class="comment">// text string</span></div>
<div class="line">       -255 );                                              <span class="comment">// minimum accepted score</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> aln::SimpleGotohScheme scoring(                       <span class="comment">// build a Gotoh scoring scheme</span></div>
<div class="line">     2,                                                     <span class="comment">// match bonus</span></div>
<div class="line">    -1,                                                     <span class="comment">// mismatch penalty</span></div>
<div class="line">    -1,                                                     <span class="comment">// gap open penalty</span></div>
<div class="line">    -1 )                                                    <span class="comment">// gap extension penalty</span></div>
<div class="line"></div>
<div class="line">aln::Best2Sink&lt;<a class="code" href="group___basic.html#ga938b5b5bd985a42f95879b4616c3ea8a">int32</a>&gt; best2;                                <span class="comment">// keep the best 2 scores</span></div>
<div class="line">aln::<a class="code" href="group___alignment.html#ga0ff728fc0b7e7d91671772d29b3279d2">banded_alignment_score</a>&lt;5&gt;(</div>
<div class="line">       aln::<a class="code" href="group___aligner.html#ga9da0d90282e4a8f0d952d5cf8ef6d3b4">make_gotoh_aligner</a>&lt;aln::<a class="code" href="group___alignment_type_module.html#ggab731872890371bb772663612b5b9c717a83c90630a3fb75f8bcce0132ce7776fa">LOCAL</a>&gt;( scoring ),      <span class="comment">// build a local Gotoh aligner</span></div>
<div class="line">       pattern,                                             <span class="comment">// pattern string</span></div>
<div class="line">       <a class="code" href="group___rank_dictionary_module.html#ga71a2197ba0cf4fd168a7c8f60865d0a6">text</a>,                                                <span class="comment">// text string</span></div>
<div class="line">       -255,                                                <span class="comment">// minimum accepted score</span></div>
<div class="line">       best2 );                                             <span class="comment">// alignment sink</span></div>
</div><!-- fragment --><p><a class="anchor" id="AlignersAnchor"></a></p>
<h1><a class="anchor" id="AlignersSection"></a>
Aligners and Alignment Algorithms</h1>
<dl class="section user"><dt></dt><dd>In the previous section we have seen that scoring functions take an aligner as an input. NVBIO exposes three such types, which specify the actual type of alignment scheme to use: </dd></dl>
<dl class="section user"><dt></dt><dd><ul>
<li><a class="el" href="structnvbio_1_1aln_1_1_edit_distance_aligner.html#EditDistanceAligner">EditDistanceAligner</a></li>
<li><a class="el" href="structnvbio_1_1aln_1_1_smith_waterman_aligner.html#SmithWatermanAligner">SmithWatermanAligner</a></li>
<li><a class="el" href="structnvbio_1_1aln_1_1_gotoh_aligner.html#GotohAligner">GotohAligner</a> </li>
</ul>
</dd></dl>
<dl class="section user"><dt></dt><dd>These objects are parameterized by an <a class="el" href="group___alignment_type_module.html">AlignmentType</a>, which can be any of GLOBAL, SEMI_GLOBAL or LOCAL, and an <a class="el" href="group___algorithm_tag.html">Algorithm Tag</a>, which specifies the actual algorithm to employ. At the moment, there are three such algorithms: </dd></dl>
<dl class="section user"><dt></dt><dd><ul>
<li><a class="el" href="structnvbio_1_1aln_1_1_pattern_blocking_tag.html#PatternBlockingTag">PatternBlockingTag</a> : a DP algorithm which blocks the matrix in stripes along the pattern</li>
<li><a class="el" href="structnvbio_1_1aln_1_1_text_blocking_tag.html#TextBlockingTag">TextBlockingTag</a> : a DP algorithm which blocks the matrix in stripes along the text</li>
<li><a class="el" href="structnvbio_1_1aln_1_1_myers_tag.html#MyersTag">MyersTag</a> : the Myers bit-vector algorithm, a very fast algorithm to perform edit distance computations</li>
</ul>
</dd></dl>
<h1><a class="anchor" id="TracebackSection"></a>
Traceback</h1>
<dl class="section user"><dt></dt><dd>Traceback is the process of computing the actual alignment between two strings, that is to say the series of edits (character replacements, insertions and deletions) necessary to obtain a given alignment. Traceback functions can either report a single optimal alignment, or enumerate all possible alignments. Once again, the output alignments are built implicitly, calling a user-defined <a class="el" href="alignment_page.html#Backtracer">Backtracer</a> delegate. </dd></dl>
<dl class="section user"><dt></dt><dd>Again, the module exposes both banded and whole-matrix traceback:<ul>
<li><a class="el" href="group___alignment.html#gae82a0091deb359cd5c13bf1c2daf90c8">banded_alignment_traceback()</a></li>
<li><a class="el" href="group___alignment.html#ga3e64b99b9bec41f3892c94976283cd26">alignment_traceback()</a></li>
</ul>
</dd></dl>
<h2><a class="anchor" id="Backtracer"></a>
Backtracer Model</h2>
<dl class="section user"><dt></dt><dd>A backtracer is a user-defined delegate implementing the following interface:</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Backtracer</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// soft-clip the next n characters</span></div>
<div class="line">    <span class="keywordtype">void</span> clip(<span class="keyword">const</span> <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> n);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// push the given string edit</span></div>
<div class="line">    <span class="keywordtype">void</span> push(<span class="keyword">const</span> <a class="code" href="group___alignment.html#ga89d5658212e7771ce32cc2504c4edb10">DirectionVector</a> op);  <span class="comment">// op = {SUBSTITUTION|INSERTION|DELETION}</span></div>
<div class="line">};</div>
</div><!-- fragment --> <dl class="section user"><dt></dt><dd>Notice that traceback algorithms will push operations backwards, starting from the end of the alignment and proceeding towards the source. The very first and very last operations will be calls to clip(n), potentially with n = 0, signalling the length of the soft-clipping areas respectively at the end and beginning of the pattern.</dd></dl>
<h1><a class="anchor" id="MemoryMangamentSection"></a>
Memory Management</h1>
<dl class="section user"><dt></dt><dd>Some of the functions in this module require a certain amount of temporary storage, for example to store a column of the DP matrix while scoring it, or a stripe of the flow matrix for traceback. On a CPU, running a modest amount of threads, one would typically either allocate this storage on the heap inside the function itself and free it before returning, or require the user to pass an allocator. On a GPU, where thousands of threads might call into the same function at once, both strategies would likely be very inefficient because of resource contention (an allocator would have to do some form of locking to be thread safe). Instead, nvbio delegates the responsibility to the caller, who needs to pass the necessary temporary storage (e.g. a matrix column) to the function. The temporary storage type is a template iterator, meaning that the user is able to control freely and exactly what kind of memory is passed and its addressing scheme (for example, one could pass a plain local memory array, but also a strided_iterator pointing to some global memory arena). Convenience functions are available to let nvbio do the necessary allocations at compile-time in local memory, but the user needs to be aware of the fact that:<ul>
<li>1. the maximum problem size needs to be statically provided at compile-time</li>
<li>2. when calling into these functions from a large thread grid, the amount of allocated local memory might be significant. This is particularly problematic for traceback functions, which can easily need up to ~50KB per thread.</li>
</ul>
</dd></dl>
<h1><a class="anchor" id="BatchAlignmentSection"></a>
Batch Alignment</h1>
<dl class="section user"><dt></dt><dd>Besides offering functions to compute an individual alignment between a single pattern and a single text (from within a thread or a warp), this module offers <a class="el" href="group___batch_alignment.html">parallel execution contexts</a> for performing larger batches of alignment jobs on the <em>device</em> with a single call. Under the hood, these contexts dispatch the parallel execution invoking one or multiple kernels, possibly splitting the computations of each alignment in many smaller chunks so as to load balance and re-gather execution coherence. The parallel algorithm employed is specified at compile-time by a <a class="el" href="group___batch_scheduler.html">Batch Scheduler</a>. </dd></dl>
<dl class="section user"><dt></dt><dd>The following code snippet shows an example using the convenience function <a class="el" href="group___batch_alignment.html#ga96aa53d0150bba09d393f544c11a865f">batch_alignment_score()</a> :</dd></dl>
<p><a class="anchor" id="BatchAlignmentExample"></a></p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> n_strings   = 10000;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> pattern_len = 100;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> text_len    = 200;</div>
<div class="line"></div>
<div class="line"><span class="comment">// build two concatenated string sets</span></div>
<div class="line">thrust::device_vector&lt;uint8&gt;  pattern_storage( n_strings * pattern_len );</div>
<div class="line">thrust::device_vector&lt;uint32&gt; pattern_offsets( n_strings+1 );</div>
<div class="line">thrust::device_vector&lt;uint8&gt;  text_storage( n_strings * text_len );</div>
<div class="line">thrust::device_vector&lt;uint32&gt; text_offsets( n_strings+1 );</div>
<div class="line"></div>
<div class="line"><span class="comment">// fill their content with random characters in [0,4)</span></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> <a class="code" href="divsufsort_8c.html#a6572f1706059832f94025fa12c6c45ed">ALPHABET_SIZE</a> = 4u;</div>
<div class="line">fill_random( ALPHABET_SIZE, pattern_storage.begin(), pattern_storage.end() );</div>
<div class="line">fill_random( ALPHABET_SIZE, text_storage.begin(), text_storage.end() );</div>
<div class="line"></div>
<div class="line"><span class="comment">// prepare their offset vectors</span></div>
<div class="line">thrust::sequence( pattern_offsets.begin(), pattern_offsets.begin() + n_strings+1, 0u, pattern_len );</div>
<div class="line">thrust::sequence( text_offsets.begin(),    text_offsets.begin()    + n_strings+1, 0u, text_len );</div>
<div class="line"></div>
<div class="line"><span class="comment">// prepare a vector of alignment sinks</span></div>
<div class="line">thrust::device_vector&lt; aln::BestSink&lt;uint32&gt; &gt; sinks( n_strings );</div>
<div class="line"></div>
<div class="line"><span class="comment">// and execute the batch alignment</span></div>
<div class="line"><a class="code" href="group___batch_alignment.html#ga96aa53d0150bba09d393f544c11a865f">aln::batch_alignment_score</a>(</div>
<div class="line">    <a class="code" href="group___aligner.html#ga855f2a3899e7fb9df9fdb0b56da9e9aa">aln::make_edit_distance_aligner</a>&lt;<a class="code" href="group___alignment_type_module.html#ggab731872890371bb772663612b5b9c717a7477ebd7c13511f0b3c5660d337b8413">aln::SEMI_GLOBAL</a>, MyersTag&lt;ALPHABET_SIZE&gt; &gt;(),</div>
<div class="line">    <a class="code" href="group___string_sets_module.html#ga2d1653be175414216f969b1513471a2a">make_concatenated_string_set</a>( n_strings, pattern_storage.begin(), pattern_offsets.begin() ),</div>
<div class="line">    <a class="code" href="group___string_sets_module.html#ga2d1653be175414216f969b1513471a2a">make_concatenated_string_set</a>( n_strings, text_storage.begin(),    text_offsets.begin() ),</div>
<div class="line">    sinks.begin(),</div>
<div class="line">    <a class="code" href="group___batch_scheduler.html#ga8d26fb0c847e458b838e5f98893af1a4">aln::DeviceThreadScheduler</a>() );</div>
</div><!-- fragment --><h1><a class="anchor" id="TechnicalOverviewSection"></a>
Technical Overview</h1>
<dl class="section user"><dt></dt><dd>A complete list of the classes and functions in this module is given in the <a class="el" href="group___alignment.html">Alignment Module</a> documentation. </dd></dl>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Feb 23 2015 19:36:54 for NVBIO by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.4
</small></address>
</body>
</html>
