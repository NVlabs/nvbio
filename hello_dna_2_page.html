<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>NVBIO: Hello DNA! - Part 2</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
  m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-47310325-1', 'nvlabs.github.io');
    ga('send', 'pageview');
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NVBIO
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">NVBIO</a></li><li class="navelem"><a class="el" href="nvbio_page.html">NVBIO</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Hello DNA! - Part 2 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section user"><dt></dt><dd>This page will teach you to familiarize with NVBIO's notion of <a class="el" href="strings_page.html">string sets</a> and with some basic parallel constructs. Assume you have the string from the previous example, but now want to extract all of its 3-mers, for example to use them in a seed &amp; extend aligner. The collection of all 3-mers can be thought of as a set of substrings, or <em>infixes</em> of your original string; NVBIO represents such an object as an InfixSet. Moreover, it provides a function to extract the coordinates of such seeds in <em>parallel</em>.</dd></dl>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="packed__vector_8h.html">nvbio/basic/packed_vector.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="primitives_8h.html">nvbio/basic/primitives.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="alphabet_8h.html">nvbio/strings/alphabet.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="infix_8h.html">nvbio/strings/infix.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="seeds_8h.html">nvbio/strings/seeds.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>nvbio;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="bgzip_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// our hello world ASCII string</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> dna_string[] = <span class="stringliteral">&quot;ACGTTGCA&quot;</span>;</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> len = <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a>( strlen( dna_string ) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// our DNA alphabet size, in bits</span></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> ALPHABET_SIZE = <a class="code" href="structnvbio_1_1_alphabet_traits.html">AlphabetTraits&lt;DNA&gt;::SYMBOL_SIZE</a>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// instantiate a packed host vector</span></div>
<div class="line">    <a class="code" href="structnvbio_1_1_packed_vector.html">nvbio::PackedVector&lt;host_tag,ALPHABET_SIZE&gt;</a> h_dna( len );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// and fill it in with the contents of our original string, converted</span></div>
<div class="line">    <span class="comment">// to a 2-bit DNA alphabet (i.e. A = 0, C = 1, G = 2, T = 3)</span></div>
<div class="line">    <a class="code" href="group___packed_streams.html#ga147c1e11fff8cdf59730cc169c40f31a">nvbio::assign</a>( len, nvbio::from_string&lt;DNA&gt;( dna_string ), h_dna.begin() );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// copy the packed vector to the device</span></div>
<div class="line">    <a class="code" href="structnvbio_1_1_packed_vector.html">nvbio::PackedVector&lt;device_tag,ALPHABET_SIZE&gt;</a> d_dna( h_dna );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// prepare a vector to store the coordinates of the resulting infixes</span></div>
<div class="line">    <a class="code" href="structnvbio_1_1vector.html">nvbio::vector&lt;device_tag,string_infix_coord_type&gt;</a> d_seed_coords;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> n_seeds = <a class="code" href="group___string_sets_module.html#ga4267e15bcaeb5194447728a8377f0c79">enumerate_string_seeds</a>(</div>
<div class="line">        len,                                   <span class="comment">// the string length</span></div>
<div class="line">        <a class="code" href="structnvbio_1_1uniform__seeds__functor.html">uniform_seeds_functor&lt;&gt;</a>( 3u, 1u ),     <span class="comment">// a seeding functor, specifying to extract</span></div>
<div class="line">                                               <span class="comment">// all 3-mers offset by 1 base each</span></div>
<div class="line">        d_seed_coords );                       <span class="comment">// the output infix coordinates</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// define an infix-set to represent the resulting infixes</span></div>
<div class="line">    <span class="keyword">typedef</span> <a class="code" href="structnvbio_1_1_packed_stream.html">nvbio::PackedVector&lt;device_tag,ALPHABET_SIZE&gt;::iterator</a>           packed_iterator_type;</div>
<div class="line">    <span class="keyword">typedef</span> <a class="code" href="structnvbio_1_1vector.html">nvbio::vector&lt;device_tag,string_infix_coord_type&gt;::const_iterator</a> infix_iterator_type;</div>
<div class="line">    <span class="keyword">typedef</span> <a class="code" href="structnvbio_1_1_infix_set.html">InfixSet&lt;packed_iterator_type, infix_iterator_type&gt;</a>               infix_set_type;</div>
<div class="line"></div>
<div class="line">    infix_set_type d_seeds(</div>
<div class="line">        n_seeds,                                <span class="comment">// the number of infixes in the set</span></div>
<div class="line">        d_dna.begin(),                          <span class="comment">// the underlying string</span></div>
<div class="line">        d_seed_coords.begin() );                <span class="comment">// the iterator to the infix coordinates</span></div>
<div class="line"></div>
<div class="line">    ...</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>At this point it would be nice to do something with the string-set we just created. For the sake of the example, we will just print all its strings. Technically, we could just loop through the strings in the set, and print them on the host. However, suppose we want to do it in the native space of the set, i.e. on the device, and suppose we want to do it in parallel: how can we do this? Well, we will do it here using a <a class="el" href="primitives_page.html">parallel primitive</a>, and particularly the <a class="el" href="group___primitives.html#ga7e41fe5fa9492bbda2aca33a52732c25">for_each()</a> construct:</dd></dl>
<div class="fragment"><div class="line">    ...</div>
<div class="line"></div>
<div class="line">    nvbio::for_each&lt;device_tag&gt;(</div>
<div class="line">        n_seeds,                                      <span class="comment">// the loop&#39;s sequence size</span></div>
<div class="line">        seeds.begin(),                                <span class="comment">// the loop&#39;s begin iterator</span></div>
<div class="line">        print_strings&lt;infix_set_type&gt;() );            <span class="comment">// the loop&#39;s body</span></div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section user"><dt></dt><dd><a class="el" href="group___primitives.html#ga7e41fe5fa9492bbda2aca33a52732c25">for_each()</a> takes a functor encoding the body of our loop, and applies it to all elements of a sequence. In this case, the sequence is the string-set, and the body of our loop will be the following:</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> <span class="keywordtype">string</span>_set_type&gt;</div>
<div class="line"><span class="keyword">struct </span>print_strings</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> string_set_type::string_type string_type;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="types_8h.html#aae8f5a3072675fd93df702e927eaf540">NVBIO_HOST_DEVICE</a></div>
<div class="line">    <span class="keywordtype">void</span> operator() (<span class="keyword">const</span> string_type <span class="keywordtype">string</span>)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        <span class="comment">// build an ASCII string</span></div>
<div class="line">        <span class="keywordtype">char</span> seed[4];</div>
<div class="line">        nvbio::to_string&lt;DNA&gt;(</div>
<div class="line">            string,                    <span class="comment">// the input string</span></div>
<div class="line">            <a class="code" href="group___basic.html#gae962be09940c267ce467e74a160a542a">nvbio::length</a>( <span class="keywordtype">string</span> ),   <span class="comment">// its length</span></div>
<div class="line">            seed );                    <span class="comment">// the output ASCII string</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">// and print it...</span></div>
<div class="line">        printf(<span class="stringliteral">&quot;%s\n&quot;</span>, seed);</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><dl class="section user"><dt></dt><dd>Notice how we marked our print_strings methods with the NVBIO_HOST_DEVICE qualifier: this tells the CUDA compiler that these methods can be compiled both for the host and the device.<br/>
 It is also worth mentioning that if we kept our vectors on the host (i.e. replacing the device_tag specifiers with host_tag), everything would have still run in parallel, except it would have run on the host.</dd></dl>
<p>Next: <a class="el" href="fmmap_page.html">All-Mapping using an FM-index</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jan 28 2015 17:17:17 for NVBIO by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.4
</small></address>
</body>
</html>
