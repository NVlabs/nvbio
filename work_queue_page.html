<!-- HTML header for doxygen 1.8.4-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>NVBIO: Work-Queues</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
  m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-47310325-1', 'nvlabs.github.io');
    ga('send', 'pageview');
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NVBIO
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">NVBIO</a></li><li class="navelem"><a class="el" href="nvbio_page.html">NVBIO</a></li><li class="navelem"><a class="el" href="basic_page.html">Basic Module</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Work-Queues </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section user"><dt></dt><dd>This module contains a series of classes that implement a variety of CUDA work-queues. A work-queue is an object which allows to execute (or consume) a stream of work items according to different schedulers. Notably, there's two distinguishing features:<ul>
<li><em><b>continuations:</b></em> work items can produce <em>continuations</em>: breaking up long computations in shorter pieces and using smart schedulers might allow to get better utilization when the execution time of individual work items is highly non-uniform;</li>
<li><em><b>capacity constraints:</b></em> queues can be assigned a <em>maximum capacity</em>, which can be used to control the amount of resources consumed to execute the work items in parallel (e.g. if each work item needs 1MB of temporary storage, on a 4GB GPU one might only execute 4k items in parallel)</li>
</ul>
</dd></dl>
<h1><a class="anchor" id="Work-Streams"></a>
Work-Streams</h1>
<dl class="section user"><dt></dt><dd>The user of these classes have to specify a WorkStream class responsible for feeding work to the queue in the shape of a subclass WorkStream::WorkUnit. The latter is responsible for specifying the data and execution of each unit. WorkStream has to implement the following interface:</dd></dl>
<div class="fragment"><div class="line"><span class="keyword">interface </span>WorkStream</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> size() <a class="code" href="build_2contrib_2zlib-1_82_87_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a></div>
<div class="line">   <span class="keywordtype">void</span>   <a class="code" href="namespacenvbio.html#a2f5d633b507416ef81a8875666c00f33">get</a>(<a class="code" href="build_2contrib_2zlib-1_82_87_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> i, WorkUnit* <a class="code" href="group___work_queue_detail.html#gac49c20b2dd9dabac8da8024266099edc">unit</a>, <a class="code" href="build_2contrib_2zlib-1_82_87_2zconf_8h.html#a2c212835823e3c54a8ab6d95c652660e">const</a> uint2 queue_slot)</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section user"><dt></dt><dd>queue_slot specifies a (queue position, queue id) pair, assuming there can be one input and one output continuation queue which are swapped among iterations. Knowing the queue slot can be useful to bind external data to a work-unit. </dd></dl>
<dl class="section user"><dt></dt><dd>When the method WorkQueue::consume( stream ) is called, the queue will launch a kernel to consume all WorkUnit's in the stream. WorkUnit has to implement a single method:</dd></dl>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> WorkUnit::run(<span class="keyword">const</span> WorkStream&amp; context)</div>
</div><!-- fragment --> <dl class="section user"><dt></dt><dd>which should run the associated work and indicate whether the unit has finished execution, or whether it has produced a continuation (stored in the WorkUnit itself), that has to be run further. The <a class="el" href="structnvbio_1_1cuda_1_1_work_queue.html">WorkQueue</a> will automatically queue the continuation for later execution. </dd></dl>
<dl class="section user"><dt></dt><dd>Optionally, the class can also be passed a WorkMover which is responsible for moving external data attached to any WorkUnit when its continuation gets assigned a new execution slot. This must implement a method:</dd></dl>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> move(</div>
<div class="line">    <span class="keyword">const</span> WorkStream&amp; <a class="code" href="group___work_queue_detail.html#ga6a9ef7a5de8befd9e8232679a6d58e26">stream</a>,</div>
<div class="line">    <span class="keyword">const</span> uint2 src_slot, WorkUnit* src_unit,</div>
<div class="line">    <span class="keyword">const</span> uint2 dst_slot, WorkUnit* dst_unit) <span class="keyword">const</span>;</div>
</div><!-- fragment --><h1><a class="anchor" id="WorkQueueExampleSection"></a>
Example</h1>
<div class="fragment"><div class="line"><span class="keyword">struct </span>MyWorkStream;</div>
<div class="line"></div>
<div class="line"><span class="comment">// A work unit returning a continuation for odd indices.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keyword">struct </span>MyWorkUnit</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// construct this work unit</span></div>
<div class="line">    __device__ MyWorkUnit(<span class="keyword">const</span> <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> _i) : i(_i) {}</div>
<div class="line"></div>
<div class="line">    <span class="comment">// run this work unit</span></div>
<div class="line">    __device__ <span class="keywordtype">bool</span> run(MyWorkStream&amp;);</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> i;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// A stream of work units</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keyword">struct </span>MyWorkStream</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// construct this work stream</span></div>
<div class="line">    MyWorkStream(<span class="keyword">const</span> _size) : m_size(_size) {}</div>
<div class="line"></div>
<div class="line">    <span class="comment">// return the size of the stream</span></div>
<div class="line">    __host__ __device__ <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> size()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_size; }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// get a work unit, assigned to a given execution slot</span></div>
<div class="line">    __device__ <span class="keywordtype">void</span> <span class="keyword">get</span>(<span class="keyword">const</span> <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> i, MyWorkUnit* <a class="code" href="group___work_queue_detail.html#gac49c20b2dd9dabac8da8024266099edc">unit</a>, <span class="keyword">const</span> uint2 execution_slot) <span class="keyword">const</span>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> m_size;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// get a work unit</span></div>
<div class="line">__device__ <span class="keywordtype">void</span> <a class="code" href="namespacenvbio.html#a2f5d633b507416ef81a8875666c00f33">MyWorkStream::get</a>(<span class="keyword">const</span> <a class="code" href="group___basic.html#gac34ecd066ef3371643ada1f73d9a2e96">uint32</a> i, MyWorkUnit* unit, <span class="keyword">const</span> uint2 execution_slot)<span class="keyword"> const </span>{ *unit = MyWorkUnit(i); }</div>
<div class="line"></div>
<div class="line"><span class="comment">// run the work unit</span></div>
<div class="line">__device__ <span class="keywordtype">bool</span> MyWorkUnit::run(MyWorkStream&amp;) { <span class="keywordflow">if</span> (i&amp;1) { i/=2; <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="namespacenvbio_1_1html.html#a6346ebd2b91b4d8989106edfdee4a302">test</a>()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// instantiate a work stream</span></div>
<div class="line">    MyWorkStream work_stream( 1024*1024 );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// instantiated a work queue</span></div>
<div class="line">    cuda::WorkQueue&lt;cuda::InplaceQueueTag,MyWorkUnit&gt; work_queue;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// consume all work in the work stream</span></div>
<div class="line">    work_queue.consume( work_stream );</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="WorkQueueSchedulersSection"></a>
Work-Queue Schedulers</h1>
<p>The <a class="el" href="structnvbio_1_1cuda_1_1_work_queue.html">WorkQueue</a> class is parameterized by a template tag parameter specifying the scheduler. The available schedulers are:</p>
<ul>
<li><a class="el" href="structnvbio_1_1cuda_1_1_inplace_queue_tag.html">InplaceQueueTag</a> (see <a class="el" href="structnvbio_1_1cuda_1_1_work_queue.html">WorkQueue</a>)</li>
<li><a class="el" href="structnvbio_1_1cuda_1_1_multi_pass_queue_tag.html">MultiPassQueueTag</a> (see <a class="el" href="structnvbio_1_1cuda_1_1_work_queue_3_01_multi_pass_queue_tag_00_01_work_unit_t_00_01_b_l_o_c_k_d_i_m_01_4.html">WorkQueue&lt;MultiPassQueueTag,WorkUnitT,BLOCKDIM&gt;</a>)</li>
<li><a class="el" href="structnvbio_1_1cuda_1_1_persistent_warps_queue_tag.html">PersistentWarpsQueueTag</a> (see <a class="el" href="structnvbio_1_1cuda_1_1_work_queue_3_01_persistent_warps_queue_tag_00_01_work_unit_t_00_01_b_l_o_c_k_d_i_m_01_4.html">WorkQueue&lt;PersistentWarpsQueueTag,WorkUnitT,BLOCKDIM&gt;</a>)</li>
<li><a class="el" href="structnvbio_1_1cuda_1_1_persistent_threads_queue_tag.html">PersistentThreadsQueueTag</a> (see <a class="el" href="structnvbio_1_1cuda_1_1_work_queue_3_01_persistent_threads_queue_tag_00_01_work_unit_t_00_01_b_l_o_c_k_d_i_m_01_4.html">WorkQueue&lt;PersistentThreadsQueueTag,WorkUnitT,BLOCKDIM&gt;</a>)</li>
<li><a class="el" href="structnvbio_1_1cuda_1_1_ordered_queue_tag.html">OrderedQueueTag</a> (see <a class="el" href="structnvbio_1_1cuda_1_1_work_queue_3_01_ordered_queue_tag_00_01_work_unit_t_00_01_b_l_o_c_k_d_i_m_01_4.html">WorkQueue&lt;OrderedQueueTag,WorkUnitT,BLOCKDIM&gt;</a>) </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jan 30 2015 16:43:07 for NVBIO by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.4
</small></address>
</body>
</html>
